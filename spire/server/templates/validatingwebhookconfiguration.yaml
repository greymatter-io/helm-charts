apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  name: registrar
  labels:
    chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    release: "{{ $.Release.Name }}"
    heritage: "{{ $.Release.Service }}"
webhooks:
  - name: registrar.{{ .Values.global.spire.namespace }}.svc.cluster.local
    clientConfig:
      service:
        name: registrar
        namespace: {{ .Values.global.spire.namespace }}
        path: "/validate"
        port: 8444
      caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUdDekNDQS9PZ0F3SUJBZ0lFWDllMWRUQU5CZ2txaGtpRzl3MEJBUXNGQURCOU1Rc3dDUVlEVlFRR0V3SlYKVXpFUk1BOEdBMVVFQ0JNSVZtbHlaMmx1YVdFeEV6QVJCZ05WQkFjVENrRnNaWGhoYm1SeWFXRXhGREFTQmdOVgpCQW9UQzBkeVpYa2dUV0YwZEdWeU1SUXdFZ1lEVlFRTEV3dEZibWRwYm1WbGNtbHVaekVhTUJnR0ExVUVBeE1SCmNYVnBZMnR6ZEdGeWRDQW9VbTl2ZENrd0hoY05NakF4TWpFME1UZzFOalV6V2hjTk16QXhNakV5TVRnMU5qVXoKV2pDQmhURUxNQWtHQTFVRUJoTUNWVk14RVRBUEJnTlZCQWdUQ0ZacGNtZHBibWxoTVJNd0VRWURWUVFIRXdwQgpiR1Y0WVc1a2NtbGhNUlF3RWdZRFZRUUtFd3RIY21WNUlFMWhkSFJsY2pFVU1CSUdBMVVFQ3hNTFJXNW5hVzVsClpYSnBibWN4SWpBZ0JnTlZCQU1UR1hGMWFXTnJjM1JoY25RZ0tFbHVkR1Z5YldWa2FXRjBaU2t3Z2dJaU1BMEcKQ1NxR1NJYjNEUUVCQVFVQUE0SUNEd0F3Z2dJS0FvSUNBUUNVK01UYW9ia0tIYmlGblpwVDBkZEFPOXI4cG56NApNaXNJOS95N3VGVWpmL1JyN0ZsM0NSSllXNVg0dGg4YXl3L3JCTndkUnFuaVExN1V1am0rekIwdXVpeG1NZDdGCjBKNURrS1p6VGJPVUtWcXl6TE9JS0RtdTZ5aVByM0ViVzkwSXFWeDNSNUFkR0ZoUGhWTDdVSkhwdC9iYlFYTU0KK3c2d0VNZE1LNnpVdVkyVlJ1U05zb0F5L0Q5K1pRUXdIcndSQ1p6ZVpkaGJUV1cvYms5WjNheVlsSWo4c0FYQwpxR21lS0JDRFQ2cWcvNXVRMURxNzZGZlpBYllvSytCUVVIWUtGNERuRWRaaTV1V1Y3cUVkWjlJS0RMaUliRVQ0CnBYcXBXanlnL3g4Y1JzSzl6Y2xPdGUzbmtzVWZBR0s0MHJOQXB5c3g1Vk1oY0NYR1V4MzVkSURNZkFCWjBvT0wKWkJ3dHF1N1ltRWpDUW1UTmZMN3U0UHBNM2NjYVZDOXJ3d25ON1FLa2FZWEdaZC9XVUQ5V1pmbGFnVk1NdXl6Tgp5N1AzRnlkK01KUy9TY3E3eG1XeWdTSGFTOUtSZGlKeWRSM3RINmVUclVHbk1QZXV1MzlkRkZwaUQ1b0U1WEk4Ck9lNlNZQW1MQlRIc1JIeU9XdVlXSWFnVzZRNmhkSzgyWTJET1VFOTE0YWt6R0ZDSjcrMlBpVUsrWWduUk04VkkKaEZOakJTdlZHSVlOL2dURU5BWXQwUXJZL2hPYWlhMVJkbGswdUMwMndwZU1IUDdSZkRYQmlhU1d4YVJ5czNyWApRenhYcnZBbXB6VmljUkpuMkk1K3VSNXhmY0h6dkZ5TDV3bHBKUnQ4eVRJZi9INFBmUWxMY1VhR0FmR3hvbkYvCnJlRnVkaWU5eHBlNmlRSURBUUFCbzRHSk1JR0dNQTRHQTFVZER3RUIvd1FFQXdJQmhqQVBCZ05WSFJNQkFmOEUKQlRBREFRSC9NQjBHQTFVZERnUVdCQlJnbXM0eU5LSWJiZWhtTWJqV29vWTA5Zmcrc2pBZkJnTlZIU01FR0RBVwpnQlEwQmZiRCtLbVdIUnJLMWNKVG1BY3g2NnFYTWpBakJnTlZIUkVFSERBYWdoaHhkV2xqYTNOMFlYSjBMbWR5ClpYbHRZWFIwWlhJdWFXOHdEUVlKS29aSWh2Y05BUUVMQlFBRGdnSUJBTUdVVGZBSUcvbG51cEZGZm5zSkNQaEMKZHRuSzliK3l2WlRES2ZMQWRrQmQ1dHNYQkNoTjVLRGE1QTZwL1ZwbThjVkxoVk1HUjhncFE4YjR3eUI1enkzWAplMkRWR2ZjR0lqNzlkWlBsKzNnK2tpeERIOG82eFl6Y3Q4eTNIVFhXRHpyT2k4MjlTVTNETStoams1WU1JZ1YwCmcrQzFyR045SEZOaUNydGJkN3FUTTlyLy9vaStVRm5jMzJsa0hvbnR4YU9xKzBqUm41YjFscm1MTENObzJEMjEKWStOaVRHRTU2cU1kSjU4MmdDY3Q1b1VRVjZ1ZnQ4cVJ2S3l1cXZRSHUzS280Q0dWVW9rUmNXNnJaTEZYTzlnZgpCWG9EaEV6alEzcHJSOWJabFBPU1EzMVl1YlpKK0ZPdjJLTWE4STEwMlBnU1FGQ3hFMFM1Q0puUUJvTE8vcVlXClJRcFlsTzZpVUtrUW8xa25VSzh4cnp6TkxtY3FQYVZyZHhFUUNkZ3o1akRTZEU1U1pzU3I1c3AxMVNPdzFOYVgKZHVJclI1MHMxWC9jN3JQM00xc25GWU03YVNnZXJNRjNCOW1IREo1UjJxODkzODJsTklERHVkdVlaV251UTJ2UgpvejFJRXJNdEY3U1RHTkxiTDVGUWl0bU9PdWRTb2NlcnVUdVduTlBlQjYvaWIyTVFjK0R4RDJ3eWdkVWdhckFECkdSb0dMRVFaME84Z2hpZnZreVBJRU9kZW9kbGc2eE1qV2lEYlYxUUxSRlkxMDJpKytRNk5McEY4SUJkMXZoR3IKcndWaDJSUXlQdUl6VWRvQUJlRUJ1MVlYSUpEUTZ3V2tFYXkrVy83SEZFNjdSV04vZjM4OW9VZHRNSmV2VmFNTQozcG01amwxYTFzUU1lVlk4SDhLUQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlGM3pDQ0E4ZWdBd0lCQWdJRVg5ZTFkVEFOQmdrcWhraUc5dzBCQVFzRkFEQjlNUXN3Q1FZRFZRUUdFd0pWClV6RVJNQThHQTFVRUNCTUlWbWx5WjJsdWFXRXhFekFSQmdOVkJBY1RDa0ZzWlhoaGJtUnlhV0V4RkRBU0JnTlYKQkFvVEMwZHlaWGtnVFdGMGRHVnlNUlF3RWdZRFZRUUxFd3RGYm1kcGJtVmxjbWx1WnpFYU1CZ0dBMVVFQXhNUgpjWFZwWTJ0emRHRnlkQ0FvVW05dmRDa3dIaGNOTWpBeE1qRTBNVGcxTmpVeldoY05NekF4TWpFeU1UZzFOalV6CldqQjlNUXN3Q1FZRFZRUUdFd0pWVXpFUk1BOEdBMVVFQ0JNSVZtbHlaMmx1YVdFeEV6QVJCZ05WQkFjVENrRnMKWlhoaGJtUnlhV0V4RkRBU0JnTlZCQW9UQzBkeVpYa2dUV0YwZEdWeU1SUXdFZ1lEVlFRTEV3dEZibWRwYm1WbApjbWx1WnpFYU1CZ0dBMVVFQXhNUmNYVnBZMnR6ZEdGeWRDQW9VbTl2ZENrd2dnSWlNQTBHQ1NxR1NJYjNEUUVCCkFRVUFBNElDRHdBd2dnSUtBb0lDQVFEZU9FWkdUZk12T04vMlVLcEhvRm9ZM1AwVS83dmxWb25xd29tNGFkQk8KcUJNVDZDZW9ueW5MalJyV20vQm9Dc3l5b1YrVlFLTnFCcFlNcE9OdGpuRXRlcEdzOEIzYlQ1TnRRR1U0a2NCMApVRHh4UTRDUFJkOUhyUDJ0S3VHTDlMcjZxZzU1dEZiRk5YSFZnS2dTZDd3WldQODk0ZVJrYlJDUVN4WWVHWTUyCnJra3lrWmNGblJUVlFWMmRPSk50VGF2UUlEUmhjaldid3IrWlNTWHVLRE5QeFNzaTVJWmNmMEVpVWtUMm5IekMKakxSWE9xdzk3RVkrYXVIZTBMaXUwNGpVdThaOGM1T05qYWNwNjBabkQydlhXbkJ1RTVkSGhIU1dJL21zd3pYbQpuYitpTGdibHlPK2FBbElLQWxSVTVTTDdjTENRbDIvNkdqZEhFYlZ5QzBsMFZIZFpaNEJZZUFBKzhub1lkZHg3CkF4QkpDVEVubG5aMllzR0xVRmdreFMyc2hhZFNHRGdqeUJTMmhZbSs2Z0x3VDNEWDltcnNYbmlROVhGRFVmd0sKOFJlTGJuTkJhS3h3M21vN2sxeExBYXczSzFKMjg4MUpwTFFhTkhVVThyclRLWXZvenZoMHBlNmhCVVp2b0RwRQpDKzdtR21oY1ZCeVlGTFgvdVg2OW1HR3I0alo0UEpEdzVneklyb0ZCQlZEMGtMTVpUNTdzRVJuQWZXQWsvNXdmCkRPRm5YbVZoSHBuR1g4WEQ5RGdJSUk0TC9Eb2pmRHNjUUJSaXV5MmJEamNPeThGVmwyQTlHR25PalRmcy90OHQKR0tHbmQ2Q3ZMYzJlaXcvQUNHOFRIYVlPcDF6amVrQmZmeGVWRndlaHMzemE0UzhvYUlLUEhFNDIrVnF3MytZNgpEUUlEQVFBQm8yY3daVEFPQmdOVkhROEJBZjhFQkFNQ0FZWXdEd1lEVlIwVEFRSC9CQVV3QXdFQi96QWRCZ05WCkhRNEVGZ1FVTkFYMncvaXBsaDBheXRYQ1U1Z0hNZXVxbHpJd0l3WURWUjBSQkJ3d0dvSVljWFZwWTJ0emRHRnkKZEM1bmNtVjViV0YwZEdWeUxtbHZNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUJpWUF2SGZsUzVZRXVENWhydwo0WUJ0U3MxaHlwZlBSY1pJcVlTdlFhSXpjMjdsTE9rcHpiYlc5MUk4WEZIQjFzeURhdUxQYUdYcnlVY3AveXA1CkdWR3NzMXVYTk1wSEd5aXp0elZId0ZxVXpYRENwakkzQlFXRjdPTC9VcHkwWnQxQkt3YjFiaDZKNC9jSEcwQkEKWG5mamFabGg4VGt6d1cvcFppc25wZEcydDdrYkZQMmNFVjBUOTY5ZWZQa3VzVjJHcGk4R2szUmV2azg1elh5SApmMHdXM3J6NUZhT0tlbXBJZWtXN2dRS09ucXRrc21wNEZibVNhKzUrVm9MY2xGeXdWeWNCMVd6N3JlcE8rWkg4ClZHK001N0hOM0tLNzRFNDVUYXVJZmhIM3UwaW9UUVdqNDg5b2t5YTNlclJLWW1jMEg1aTZnM1FjZXFTRUl3VFkKQklsNkZGak5jK3c3aTVRQ0o1QTVsMytNbS85NXczdU9zREZ3eUp6NGtxL1J4V1p2SFNxK21EYWJtUkNKcTEyWgpPQU9VUUpmTldmWnNWR3ZJQ0JIQXVOS3pkVWFHR0ErZzZwUllUYjcvU0F3eUhtZStFMTl0d2R6dTEwMVQ1eWxXClZhL2tlSkZjbnNDcnRQazNYNmJXNUJKaWV1ajN6K0xjUXNDcTVCUUJMVTFkVE8zOWFDT0JObGE3MVV6L0pSaGwKclBjNnV0d2NxZm1nTVk5QzV5eVBZVjRRd0YraXFGMm5pSEZURXFhTWl3VGZKL2xFazBSdmVnSGxtVnBROUJZYwpSTmJQV0hXMXRkc1huRE1rbEJMQ3pRMi9LcXcwNmRibnFlY3Z5TVZrdTJOZm5kV3p0c3pOMkJBbVJ5OGpKa0R2Cjd6K3NNZGRVazZBb2lnR3F1Znd5V1lHWkhnPT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQoK
    admissionReviewVersions:
      - v1beta1
    rules:
      - apiGroups:
          - ""
        apiVersions:
          - "v1"
        operations:
          - "CREATE"
          - "DELETE"
        resources:
          - "pods"
        scope: "Namespaced"
