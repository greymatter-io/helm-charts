{{- with .Values.mongo.credentials }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ $.Values.mongo.name }}-init
  namespace: {{ $.Release.Namespace }}
  labels:
    chart: "{{ $.Chart.Name }}-{{ $.Chart.Version }}"
    release: "{{ $.Release.Name }}"
    heritage: "{{ $.Release.Service }}"
type: Opaque
stringData:
  mongo-init.js: |-
    db.auth({{ quote .root_username}}, {{ quote .root_password }})
    db = db.getSiblingDB({{ quote .database }})
    db.createUser({
      user: {{ quote .gmdata_username }}
      pwd: {{ quote .gmdata_password }}
      roles: [
        {
          role: 'root',
          db: 'admin',
        }
      ]
    });
{{- end }}